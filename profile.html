<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile | Codepolarity.io</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400..700&family=Doto:wght@100..900&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Space Grotesk', sans-serif; background: #000; color: #fff; }
    h1, h2, h3, h4, h5, h6, .main-heading { font-family: 'Doto', sans-serif !important; }
    .profile-bg { background: #000; }
    .profile-card { background: #111827; border: 1px solid #222; border-radius: 1rem; box-shadow: 0 2px 12px #000a; transition: border 0.2s, box-shadow 0.2s; }
    .profile-border { border-color: #222; }
    .profile-muted { color: #9ca3af; }
    .profile-accent { color: #60a7fa; }
    .profile-tab-active { border-bottom: 3px solid #60a7fa; color: #fff; }
    .profile-tab-inactive { border-bottom: 3px solid transparent; color: #9ca3af; }
    .profile-scrollbar::-webkit-scrollbar { display: none; }
    .profile-avatar { border: 3px solid #60a7fa; box-shadow: 0 0 16px #60a7fa44; }
    .profile-card:hover { border-color: #60a7fa; box-shadow: 0 4px 24px #60a7fa22; }
    .profile-link:hover { color: #60a7fa !important; }
    .stat-icon { color: #60a7fa; }
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.4s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(16px);} to { opacity: 1; transform: none; } }
    .transition-bg { transition: background 0.3s; }
    .light body { background: #f9fafb !important; color: #222 !important; }
    .light .profile-bg { background: #f9fafb !important; }
    .light .profile-card { background: #fff !important; border-color: #e5e7eb !important; color: #222 !important; box-shadow: 0 2px 12px #2563eb11 !important; }
    .light .profile-muted { color: #666 !important; }
    .light .profile-tab-active { border-bottom: 3px solid #2563eb !important; color: #222 !important; }
    .light .profile-tab-inactive { color: #888 !important; }
    .light .profile-avatar { border: 3px solid #2563eb !important; box-shadow: 0 0 16px #2563eb22 !important; background: #e0e7ef !important; }
    .light .profile-link:hover { color: #2563eb !important; }
    .light .stat-icon { color: #2563eb !important; }
    .light .profile-accent { color: #2563eb !important; }
    .light .profile-card:hover { border-color: #2563eb !important; box-shadow: 0 4px 24px #2563eb22 !important; }
    .light nav {
      background: rgba(255,255,255,0.85) !important;
      color: #222 !important;
      border-bottom: 1px solid #e5e7eb !important;
    }
    .light nav a, .light nav button, .light nav li { color: #222 !important; }
    .light nav .hover\:text-blue-400:hover { color: #2563eb !important; }
    .light #site-footer {
      background: #f3f4f6 !important;
      color: #222 !important;
      border-top: 1px solid #e5e7eb !important;
    }
    .light #site-footer .text-gray-400, .light #site-footer .text-gray-300 {
      color: #111 !important;
    }
    .light #site-footer .hover\:text-blue-400:hover {
      color: #2563eb !important;
    }
    .light #site-footer .border-gray-800 {
      border-color: #e5e7eb !important;
    }
    .light #firebase-login-btn {
      color: #fff !important;
    }
    .light .bg-gray-900, .light .bg-black { background: #fff !important; }
    .light .text-white { color: #222 !important; }
    .light .text-gray-400 { color: #666 !important; }
    .light .text-blue-400 { color: #2563eb !important; }
    .light .border-gray-800 { border-color: #e5e7eb !important; }
    .light .shadow-lg, .light .shadow-2xl { box-shadow: 0 4px 24px #2563eb11 !important; }
    .light .rounded-xl, .light .rounded-2xl { background: #fff !important; }
    .light .bg-gradient-to-br { background: linear-gradient(120deg, #e0e7ef 0%, #fff 100%) !important; }
    .light .from-blue-900\/30 { background-color: #e0e7ef !important; }
    .light .status-badge.bg-green-400 { background: #22c55e !important; color: #fff !important; }
    .light .status-badge.bg-yellow-400 { background: #facc15 !important; color: #222 !important; }
    .light .status-badge.bg-gray-500 { background: #e5e7eb !important; color: #888 !important; }
    nav {
      background: rgba(30, 41, 59, 0.45) !important;
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
      z-index: 10000 !important;
    }
    body.light nav {
      background: rgba(255,255,255,0.75) !important;
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
    }
    /* --- Light Theme Full Profile Page Fixes --- */
    .light .bg-gray-900, .light .bg-black { background: #fff !important; }
    .light .border-gray-700, .light .border-gray-800 { border-color: #e5e7eb !important; }
    .light .text-white { color: #222 !important; }
    .light .text-gray-400, .light .text-gray-300 { color: #666 !important; }
    .light .text-blue-400 { color: #2563eb !important; }
    .light .hover\:text-blue-400:hover { color: #2563eb !important; }
    .light .profile-card { background: #fff !important; color: #222 !important; border-color: #e5e7eb !important; }
    .light .profile-card:hover { box-shadow: 0 4px 24px #2563eb22 !important; border-color: #2563eb !important; }
    .light .profile-avatar { background: #e0e7ef !important; border-color: #2563eb !important; }
    .light .profile-link { color: #2563eb !important; }
    .light .profile-link:hover { color: #1d4ed8 !important; }
    .light .status-badge.bg-green-400 { background: #22c55e !important; color: #fff !important; }
    .light .status-badge.bg-yellow-400 { background: #facc15 !important; color: #222 !important; }
    .light .status-badge.bg-gray-500 { background: #e5e7eb !important; color: #888 !important; }
    .light .main-heading { color: #222 !important; }
    .light .tab-content { background: #fff !important; }
    .light .dropdown-anim, .light #resources-menu, .light #practice-menu, .light #profile-menu {
      background: #fff !important;
      color: #222 !important;
      border-color: #e5e7eb !important;
      box-shadow: 0 2px 12px #2563eb11 !important;
    }
    .light #mobile-menu {
      position: fixed !important;
      top: 64px !important;
      left: 0 !important;
      right: 0 !important;
      height: calc(100vh - 64px) !important;
      z-index: 9999 !important;
      background: rgba(255,255,255,0.95) !important;
      background-color: rgba(255,255,255,0.95) !important;
      color: #222 !important;
      min-height: unset !important;
      border: none !important;
      backdrop-filter: blur(18px) !important;
      -webkit-backdrop-filter: blur(18px) !important;
    }
    .light #mobile-menu a, .light #mobile-menu button {
      color: #2563eb !important;
      background: transparent !important;
    }
    .light #mobile-menu .border-b { border-color: #e5e7eb !important; }
    .light #mobile-menu .text-white { color: #222 !important; }
    .light #mobile-menu .bg-blue-500 { background: #2563eb !important; color: #fff !important; }
    .light #mobile-menu .bg-blue-500:hover { background: #1d4ed8 !important; }
    .light #mobile-menu .text-blue-400 { color: #2563eb !important; }
    .light #mobile-menu .profile-card { background: #fff !important; color: #222 !important; border-color: #e5e7eb !important; }
    .light #mobile-menu .profile-avatar { background: #e0e7ef !important; border-color: #2563eb !important; }
    .light #mobile-menu .font-semibold { color: #222 !important; }
    .light .bg-gradient-to-br { background: linear-gradient(120deg, #e0e7ef 0%, #fff 100%) !important; }
    .light .from-blue-900\/30 { background-color: #e0e7ef !important; }
    .light .shadow-lg, .light .shadow-2xl { box-shadow: 0 4px 24px #2563eb11 !important; }
    .light .rounded-xl, .light .rounded-2xl { background: #fff !important; }
    .light .focus\:ring-blue-400:focus { box-shadow: 0 0 0 2px #2563eb55 !important; }
    .light .bg-blue-500 { background: #2563eb !important; color: #fff !important; }
    .light .bg-blue-500:hover { background: #1d4ed8 !important; }
    .light .bg-green-500 { background: #22c55e !important; color: #fff !important; }
    .light .bg-green-500:hover { background: #16a34a !important; }
    .light .bg-red-500 { background: #ef4444 !important; color: #fff !important; }
    .light .bg-red-500:hover { background: #dc2626 !important; }
    .light .bg-yellow-400 { background: #facc15 !important; color: #222 !important; }
    .light .bg-gray-500 { background: #e5e7eb !important; color: #888 !important; }
    .light .border { border-color: #e5e7eb !important; }
    .light .font-bold { color: #222 !important; }
    .light .text-xs { color: #444 !important; }
    .light .text-sm { color: #444 !important; }
    .light .text-lg { color: #222 !important; }
    .light .text-base { color: #222 !important; }
    .light .stat-icon { color: #2563eb !important; }
    .light .profile-accent { color: #2563eb !important; }
    .light .profile-tab-active { border-bottom: 3px solid #2563eb !important; color: #222 !important; }
    .light .profile-tab-inactive { color: #888 !important; }
    .light .profile-muted { color: #666 !important; }
    .light .tab-btn { color: #222 !important; }
    .light .tab-btn.profile-tab-inactive { color: #888 !important; }
    .light .tab-btn.profile-tab-active { color: #222 !important; border-bottom: 3px solid #2563eb !important; }
    .light html, .light body, .light .profile-bg, .light .min-h-screen, .light .flex, .light .w-full {
      background: #f9fafb !important;
    }
    /* --- Desktop Profile Light Theme --- */
    @media (min-width: 768px) {
      .light .profile-bg, .light .min-h-screen, .light .flex, .light .w-full {
        background: #f9fafb !important;
      }
      .light .profile-card {
        background: #fff !important;
        color: #222 !important;
        border-color: #e5e7eb !important;
        box-shadow: 0 2px 12px #2563eb11 !important;
      }
      .light .profile-card:hover {
        box-shadow: 0 4px 24px #2563eb22 !important;
        border-color: #2563eb !important;
      }
      .light .profile-avatar {
        background: #e0e7ef !important;
        border-color: #2563eb !important;
      }
      .light .main-heading, .light .stat-num, .light .stat-icon {
        color: #222 !important;
      }
      .light .tab-content {
        background: #fff !important;
        color: #222 !important;
      }
      .light .profile-link { color: #2563eb !important; }
      .light .profile-link:hover { color: #1d4ed8 !important; }
      .light .status-badge.bg-green-400 { background: #22c55e !important; color: #fff !important; }
      .light .status-badge.bg-yellow-400 { background: #facc15 !important; color: #222 !important; }
      .light .status-badge.bg-gray-500 { background: #e5e7eb !important; color: #888 !important; }
      .light .profile-tab-active { border-bottom: 3px solid #2563eb !important; color: #222 !important; }
      .light .profile-tab-inactive { color: #888 !important; }
      .light .profile-muted { color: #666 !important; }
      .light .dropdown-anim, .light #resources-menu, .light #practice-menu, .light #profile-menu {
        background: #fff !important;
        color: #222 !important;
        border-color: #e5e7eb !important;
        box-shadow: 0 2px 12px #2563eb11 !important;
      }
      .light nav {
        background: rgba(255,255,255,0.85) !important;
        color: #222 !important;
        border-bottom: 1px solid #e5e7eb !important;
      }
      .light nav a, .light nav button, .light nav li { color: #222 !important; }
      .light nav .hover\:text-blue-400:hover { color: #2563eb !important; }
    }
    /* --- Enhanced Light Theme for Profile Desktop --- */
    .light html, .light body, .light .profile-bg, .light .min-h-screen, .light .flex, .light .w-full {
      background: #f5f7fa !important;
    }
    .light .profile-card {
      background: #fff !important;
      color: #1a202c !important;
      border-color: #e5e7eb !important;
      box-shadow: 0 4px 24px #2563eb0d !important;
      border-radius: 1rem !important;
    }
    .light .profile-card:hover {
      box-shadow: 0 8px 32px #2563eb22 !important;
      border-color: #2563eb !important;
    }
    .light .profile-avatar {
      background: #e0e7ef !important;
      border-color: #2563eb !important;
      box-shadow: 0 0 16px #2563eb22 !important;
    }
    .light .main-heading, .light .stat-num, .light .stat-icon {
      color: #1a202c !important;
    }
    .light .profile-muted, .light .text-gray-400, .light .text-gray-300 {
      color: #888 !important;
    }
    .light .tab-content {
      background: #fff !important;
      color: #1a202c !important;
      border-radius: 1rem !important;
      box-shadow: 0 2px 12px #2563eb0a !important;
    }
    .light .profile-link { color: #2563eb !important; }
    .light .profile-link:hover { color: #1d4ed8 !important; }
    .light .status-badge.bg-green-400 { background: #22c55e !important; color: #fff !important; }
    .light .status-badge.bg-yellow-400 { background: #facc15 !important; color: #222 !important; }
    .light .status-badge.bg-gray-500 { background: #e5e7eb !important; color: #888 !important; }
    .light .profile-tab-active { border-bottom: 3px solid #2563eb !important; color: #1a202c !important; }
    .light .profile-tab-inactive { color: #888 !important; }
    .light .dropdown-anim, .light #resources-menu, .light #practice-menu, .light #profile-menu {
      background: #fff !important;
      color: #1a202c !important;
      border-color: #e5e7eb !important;
      box-shadow: 0 4px 24px #2563eb11 !important;
      border-radius: 0.75rem !important;
    }
    .light nav {
      background: rgba(255,255,255,0.92) !important;
      color: #1a202c !important;
      border-bottom: 1px solid #e5e7eb !important;
      box-shadow: 0 2px 8px #2563eb0a !important;
    }
    .light nav a, .light nav button, .light nav li { color: #1a202c !important; }
    .light nav .hover\:text-blue-400:hover { color: #2563eb !important; }
    .light .bg-gradient-to-br, .light .profile-header-gradient {
      background: linear-gradient(120deg, #e3eafc 0%, #f5f7fa 100%) !important;
    }
    .light .from-blue-900\/30 { background-color: #e3eafc !important; }
    .light .rounded-xl, .light .rounded-2xl { background: #fff !important; border-radius: 1rem !important; }
    .light .shadow-lg, .light .shadow-2xl { box-shadow: 0 4px 24px #2563eb11 !important; }
    .light .focus\:ring-blue-400:focus { box-shadow: 0 0 0 2px #2563eb55 !important; }
    .light .bg-blue-500 { background: #2563eb !important; color: #fff !important; }
    .light .bg-blue-500:hover { background: #1d4ed8 !important; }
    .light .bg-green-500 { background: #22c55e !important; color: #fff !important; }
    .light .bg-green-500:hover { background: #16a34a !important; }
    .light .bg-red-500 { background: #ef4444 !important; color: #fff !important; }
    .light .bg-red-500:hover { background: #dc2626 !important; }
    .light .bg-yellow-400 { background: #facc15 !important; color: #222 !important; }
    .light .bg-gray-500 { background: #e5e7eb !important; color: #888 !important; }
    .light .border { border-color: #e5e7eb !important; }
    .light .font-bold { color: #1a202c !important; }
    .light .text-xs { color: #666 !important; }
    .light .text-sm { color: #666 !important; }
    .light .text-lg { color: #1a202c !important; }
    .light .text-base { color: #1a202c !important; }
    .light .stat-icon { color: #2563eb !important; }
    .light .profile-accent { color: #2563eb !important; }
    .light .tab-btn { color: #1a202c !important; }
    .light .tab-btn.profile-tab-inactive { color: #888 !important; }
    .light .tab-btn.profile-tab-active { color: #1a202c !important; border-bottom: 3px solid #2563eb !important; }
    /* --- Force main background to light in light theme --- */
    .light, .light body, .light html, .light .profile-bg, .light .min-h-screen, .light .flex, .light .w-full {
      background: #f5f7fa !important;
    }
    /* --- Only one background in light theme, no section backgrounds --- */
    .light .profile-bg, .light .min-h-screen, .light .flex, .light .w-full, .light .tab-content {
      background: transparent !important;
    }
    .light, .light body, .light html {
      background: #f5f7fa !important;
    }
    /* --- Footer inherits main background in light theme --- */
    .light #site-footer {
      background: transparent !important;
      border-top: none !important;
      color: #222 !important;
    }
    /* --- Navbar logo black in light theme --- */
    .light #logo-main,
    .light .logo img,
    .light img[src*='logo'],
    .light img[src*='cp.svg'] {
      filter: brightness(0) invert(0) grayscale(1) !important;
    }
    /* --- Theme toggle button in light mode --- */
    .light #theme-toggle {
      background: #f3f4f6 !important;
      border-color: #facc15 !important;
    }
    .light #theme-toggle-knob {
      background: #facc15 !important;
      color: #2563eb !important;
    }
    .light #theme-toggle-sun {
      color: #2563eb !important;
      opacity: 1 !important;
    }
    .light #theme-toggle-moon {
      color: #2563eb !important;
      opacity: 0 !important;
    }
    /* --- Dropdown menu animation (matches homepage) --- */
    .dropdown-anim {
      transform: translateY(-16px);
      opacity: 0;
      visibility: hidden;
      transition: opacity 150ms cubic-bezier(0.4,0,0.2,1),
                  transform 150ms cubic-bezier(0.4,0,0.2,1),
                  visibility 150ms cubic-bezier(0.4,0,0.2,1);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      background: rgba(17,24,39,0.85) !important;
    }
    .opacity-100.visible.dropdown-anim {
      opacity: 1 !important;
      visibility: visible !important;
      transform: translateY(0);
    }
    .opacity-0.invisible.dropdown-anim {
      opacity: 0 !important;
      visibility: hidden !important;
      transform: translateY(-16px);
    }
    /* --- Navbar avatar image always visible, styled for both themes --- */
    #navbar-avatar {
      background-size: cover !important;
      background-position: center !important;
      border-radius: 9999px !important;
      border: 2px solid #2563eb;
      box-shadow: 0 2px 8px #2563eb22;
      overflow: hidden;
      color: #fff;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      transition: border 0.2s, box-shadow 0.2s;
    }
    .light #navbar-avatar {
      border: 2px solid #facc15;
      box-shadow: 0 2px 8px #facc1522;
      color: #2563eb;
      background-color: #e0e7ef !important;
    }
    /* --- Mobile menu background: solid, readable, no blur, no border --- */
    #mobile-menu {
      position: fixed !important;
      top: 64px !important;
      left: 0 !important;
      right: 0 !important;
      height: calc(100vh - 64px) !important;
      z-index: 9999 !important;
      background: rgba(17,24,39,0.85) !important;
      background-color: rgba(17,24,39,0.85) !important;
      color: #fff !important;
      min-height: unset !important;
      border: none !important;
      backdrop-filter: blur(18px) !important;
      -webkit-backdrop-filter: blur(18px) !important;
    }
    .light #mobile-menu {
      position: fixed !important;
      top: 64px !important;
      left: 0 !important;
      right: 0 !important;
      height: calc(100vh - 64px) !important;
      z-index: 9999 !important;
      background: rgba(255,255,255,0.95) !important;
      background-color: rgba(255,255,255,0.95) !important;
      color: #222 !important;
      min-height: unset !important;
      border: none !important;
      backdrop-filter: blur(18px) !important;
      -webkit-backdrop-filter: blur(18px) !important;
    }
    #mobile-menu > * {
      background: transparent !important;
      background-color: transparent !important;
    }
    /* --- Force strong blur for mobile menu in both themes --- */
    #mobile-menu {
      backdrop-filter: blur(32px) !important;
      -webkit-backdrop-filter: blur(32px) !important;
    }
    .light #mobile-menu {
      backdrop-filter: blur(32px) !important;
      -webkit-backdrop-filter: blur(32px) !important;
    }
    /* --- Final: Match homepage mobile menu blur and color for both modes --- */
    #mobile-menu {
      background: rgba(17,24,39,0.85) !important;
      background-color: rgba(17,24,39,0.85) !important;
      color: #fff !important;
      backdrop-filter: blur(18px) !important;
      -webkit-backdrop-filter: blur(18px) !important;
    }
    .light #mobile-menu {
      background: rgba(255,255,255,0.95) !important;
      background-color: rgba(255,255,255,0.95) !important;
      color: #222 !important;
      backdrop-filter: blur(18px) !important;
      -webkit-backdrop-filter: blur(18px) !important;
    }
    #mobile-menu > * {
      background: transparent !important;
      background-color: transparent !important;
    }
    /* --- EXACT MATCH: Homepage mobile menu style for profile page --- */
    #mobile-menu {
      background: rgba(0,0,0,0.8) !important;
      color: #fff !important;
      backdrop-filter: blur(18px) !important;
      -webkit-backdrop-filter: blur(18px) !important;
    }
    .light #mobile-menu {
      background: rgba(255,255,255,0.95) !important;
      color: #222 !important;
      backdrop-filter: blur(18px) !important;
      -webkit-backdrop-filter: blur(18px) !important;
    }
    .light #mobile-menu a,
    .light #mobile-menu button {
      color: #2563eb !important;
      border-color: #e5e7eb !important;
      background: transparent !important;
    }
    .light #mobile-menu .border-b {
      border-color: #e5e7eb !important;
    }
    .light #mobile-menu .text-white {
      color: #222 !important;
    }
    .light #mobile-menu .bg-blue-500 {
      background: #2563eb !important;
      color: #fff !important;
    }
    .light #mobile-menu .bg-blue-500:hover {
      background: #1d4ed8 !important;
    }
    .light #mobile-menu .text-blue-400 {
      color: #2563eb !important;
    }
    #mobile-menu > * {
      background: transparent !important;
      background-color: transparent !important;
    }
    /* --- MORE BLUR: Homepage mobile menu style for profile page --- */
    #mobile-menu {
      background: rgba(0,0,0,0.8) !important;
      color: #fff !important;
      backdrop-filter: blur(32px) !important;
      -webkit-backdrop-filter: blur(32px) !important;
    }
    .light #mobile-menu {
      background: rgba(255,255,255,0.95) !important;
      color: #222 !important;
      backdrop-filter: blur(32px) !important;
      -webkit-backdrop-filter: blur(32px) !important;
    }
    /* --- MAXIMUM BLUR for mobile menu in both modes --- */
    #mobile-menu {
      background: rgba(0,0,0,0.6) !important;
      color: #fff !important;
      backdrop-filter: blur(40px) !important;
      -webkit-backdrop-filter: blur(40px) !important;
    }
    .light #mobile-menu {
      background: rgba(255,255,255,0.6) !important;
      color: #222 !important;
      backdrop-filter: blur(40px) !important;
      -webkit-backdrop-filter: blur(40px) !important;
    }
  </style>
</head>
<body class="profile-bg min-h-screen flex flex-col transition-bg">
  <!-- Navigation Bar -->
  <nav class="fixed top-0 left-0 w-full z-50 flex items-center justify-between px-8 py-1 bg-transparent backdrop-blur-md mt-2" style="height: 64px;">
    <div class="flex items-center gap-3 cursor-pointer ml-5" id="logo-toggle">
      <img src="assets/images/logo .svg" alt="Codepolarity Logo Part 1" id="logo-main" class="h-7 transition-transform duration-700" />
      <img src="assets/images/cp.svg" alt="Codepolarity Logo Part 2" class="h-7" />
    </div>
    <ul class="hidden md:flex space-x-8 text-lg font-medium items-center mr-6">
      <li><a href="index.html" class="hover:text-blue-400 transition">Home</a></li>
      <li class="relative group" id="resources-dropdown">
        <button id="resources-btn" class="hover:text-blue-400 transition flex items-center focus:outline-none" aria-haspopup="true" aria-expanded="false" type="button">
          Resources
          <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <ul id="resources-menu" class="absolute left-0 mt-2 w-40 bg-gray-900 border border-gray-700 rounded shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 dropdown-anim" tabindex="-1">
          <li><a href="Courses.html" class="block px-4 py-2 hover:bg-gray-800">Courses</a></li>
          <li><a href="#cheatsheets" class="block px-4 py-2 hover:bg-gray-800">Cheatsheets</a></li>
        </ul>
      </li>
      <li class="relative group" id="practice-dropdown">
        <button id="practice-btn" class="hover:text-blue-400 transition flex items-center focus:outline-none" aria-haspopup="true" aria-expanded="false" type="button">
          Practice
          <svg class="ml-1 w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <ul id="practice-menu" class="absolute left-0 mt-2 w-40 bg-gray-900 border border-gray-700 rounded shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 dropdown-anim" tabindex="-1">
          <li><a href="typing_t.html" class="block px-4 py-2 hover:bg-gray-800">Typing</a></li>
          <li><a href="#speedcode" class="block px-4 py-2 hover:bg-gray-800">SpeedCode</a></li>
        </ul>
      </li>
      <li><a href="about.html" class="hover:text-blue-400 transition">About</a></li>
      <li>
        <button id="theme-toggle" class="relative w-12 h-7 flex items-center bg-gray-900 border border-blue-700 rounded-full p-1 shadow transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-blue-400 group" aria-label="Toggle dark/light mode">
          <span class="absolute left-1 top-1 w-5 h-5 flex items-center justify-center rounded-full bg-blue-500 text-white shadow-md transition-transform duration-300" id="theme-toggle-knob">
            <svg id="theme-toggle-sun" class="w-4 h-4 absolute opacity-0 transition-opacity duration-300" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="5"/>
              <path d="M12 1v2m0 18v2m11-11h-2M3 12H1m16.95 7.07l-1.41-1.41M6.34 6.34L4.93 4.93m12.02 0l-1.41 1.41M6.34 17.66l-1.41 1.41"/>
            </svg>
            <svg id="theme-toggle-moon" class="w-4 h-4 absolute opacity-100 transition-opacity duration-300" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 1 0 9.79 9.79z"/>
            </svg>
          </span>
          <span class="sr-only">Toggle dark/light mode</span>
        </button>
      </li>
      <li id="desktop-login-btn"><button id="navbar-login-btn" class="bg-blue-500 text-white px-4 py-1 rounded hover:bg-blue-600 transition">Login</button></li>
      <li id="desktop-profile" class="relative hidden">
        <button id="profile-btn" class="flex items-center gap-2 px-3 py-1 rounded hover:bg-gray-800 focus:outline-none">
          <span id="navbar-avatar" class="inline-block w-7 h-7 rounded-full bg-blue-400 text-white flex items-center justify-center font-bold">U</span>
          <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <ul id="profile-menu" class="absolute right-0 mt-2 w-40 bg-gray-900 border border-gray-700 rounded shadow-lg opacity-0 invisible transition-all duration-200 z-50">
          <li><a href="profile.html" class="block px-4 py-2 hover:bg-gray-800">View Profile</a></li>
          <li><button id="logout-btn" class="block w-full text-left px-4 py-2 hover:bg-gray-800">Logout</button></li>
        </ul>
      </li>
    </ul>
    <!-- Mobile: Theme toggle + Hamburger -->
    <div class="flex items-center md:hidden fixed top-2 right-6 z-50 gap-2">
      <button id="theme-toggle-mobile" class="w-10 h-10 flex items-center justify-center bg-gray-900 border border-blue-700 rounded-full shadow focus:outline-none focus:ring-2 focus:ring-blue-400" aria-label="Toggle dark/light mode">
        <span class="sr-only">Toggle dark/light mode</span>
        <svg id="theme-toggle-mobile-icon" class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 1 0 9.79 9.79z"/>
        </svg>
      </button>
      <button id="mobile-menu-btn" class="p-2 rounded bg-black/60 text-white focus:outline-none focus:ring-2 focus:ring-blue-400" style="top: 20px;" aria-label="Open menu">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </div>
    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 top-0 z-40 flex flex-col items-center justify-start pt-0 px-6 text-lg font-medium text-white transform translate-x-full transition-transform duration-300 ease-in-out pointer-events-none backdrop-blur-2xl" style="backdrop-filter: blur(32px); -webkit-backdrop-filter: blur(32px); background: rgba(17,24,39,0.85);">
      <a href="index.html" class="block w-full py-2 border-b border-gray-700">Home</a>
      <div class="w-full">
        <button class="w-full flex justify-between items-center py-2 border-b border-gray-700 focus:outline-none" id="mobile-resources-btn">
          Resources
          <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div id="mobile-resources-menu" class="pl-4 flex-col space-y-2 overflow-hidden transition-all duration-300 ease-in-out max-h-0">
          <a href="Courses.html" class="block py-1">Courses</a>
          <a href="#cheatsheets" class="block py-1">Cheatsheets</a>
        </div>
      </div>
      <div class="w-full">
        <button class="w-full flex justify-between items-center py-2 border-b border-gray-700 focus:outline-none" id="mobile-practice-btn">
          Practice
          <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div id="mobile-practice-menu" class="pl-4 flex-col space-y-2 overflow-hidden transition-all duration-300 ease-in-out max-h-0">
          <a href="typing_t.html" class="block py-1">Typing</a>
          <a href="#speedcode" class="block py-1">SpeedCode</a>
        </div>
      </div>
      <a href="about.html" class="block w-full py-2 border-b border-gray-700">About</a>
      <div class="flex-1"></div>
      <a id="firebase-login-btn-mobile" href="login.html" class="block w-full py-2 bg-blue-500 text-white rounded text-center mb-6">Login</a>
      <div id="mobile-profile" class="w-full flex-col items-center hidden mb-6">
        <div class="flex items-center gap-2 mb-2">
          <span class="inline-block w-8 h-8 rounded-full bg-blue-400 text-white flex items-center justify-center font-bold">U</span>
          <span class="font-semibold">User</span>
        </div>
        <button id="mobile-logout-btn" class="block w-full py-2 text-center text-red-400">Logout</button>
      </div>
    </div>
  </nav>
  <div class="flex flex-col items-center w-full pt-24 pb-8 px-2 md:px-0">
    <div class="w-full max-w-4xl">
      <!-- Profile Header -->
      <div class="flex flex-col md:flex-row items-center gap-6 p-6 bg-gradient-to-br from-blue-900/30 to-transparent rounded-xl mb-4">
        <div class="relative">
          <div class="rounded-full bg-center bg-cover min-h-32 w-32 profile-avatar flex items-center justify-center overflow-hidden" id="profile-avatar-container">
            <img id="profile-avatar-img" class="w-full h-full object-cover" style="display:none;" alt="User Avatar" />
            <span id="profile-avatar-fallback" class="w-full h-full flex items-center justify-center text-3xl font-bold bg-blue-400 text-white"></span>
          </div>
          <button id="edit-avatar-btn" class="absolute bottom-2 right-2 bg-blue-500 hover:bg-blue-600 text-white rounded-full p-2 shadow-md transition" title="Change photo">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6-6m2 2a2.828 2.828 0 11-4-4 2.828 2.828 0 014 4z" /></svg>
          </button>
          <input type="file" id="avatar-file-input" accept="image/*" class="hidden" />
        </div>
        <div class="flex flex-col justify-center">
          <p class="main-heading text-2xl font-bold leading-tight"></p>
          <!-- Username and Edit Profile button removed -->
        </div>
      </div>
      <!-- Stats Cards -->
      <div class="flex flex-wrap gap-3 px-4 py-3">
        <div class="flex min-w-[111px] flex-1 flex-col gap-2 profile-card p-3 items-start">
          <div class="flex items-center gap-2"><svg class="w-5 h-5 stat-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 17v-2a4 4 0 014-4h10a4 4 0 014 4v2"/><circle cx="12" cy="7" r="4"/></svg><span class="text-2xl font-bold stat-num" data-num="23">0</span></div>
          <p class="profile-muted text-sm">Problems</p>
        </div>
        <div class="flex min-w-[111px] flex-1 flex-col gap-2 profile-card p-3 items-start">
          <div class="flex items-center gap-2"><svg class="w-5 h-5 stat-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3"/><circle cx="12" cy="12" r="10"/></svg><span class="text-2xl font-bold stat-num" data-num="1500">0</span></div>
          <p class="profile-muted text-sm">Code Hours</p>
        </div>
        <div class="flex min-w-[111px] flex-1 flex-col gap-2 profile-card p-3 items-start">
          <div class="flex items-center gap-2"><svg class="w-5 h-5 stat-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 21v-2a4 4 0 00-3-3.87"/><path stroke-linecap="round" stroke-linejoin="round" d="M9 21v-2a4 4 0 013-3.87"/><circle cx="12" cy="7" r="4"/></svg><span class="text-2xl font-bold stat-num" data-num="85">0</span></div>
          <p class="profile-muted text-sm">WPM</p>
        </div>
        <div class="flex min-w-[111px] flex-1 flex-col gap-2 profile-card p-3 items-start">
          <div class="flex items-center gap-2"><svg class="w-5 h-5 stat-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m4 4v-4a4 4 0 00-8 0v4"/></svg><span class="text-2xl font-bold stat-num" data-num="320">0</span></div>
          <p class="profile-muted text-sm">AI Interactions</p>
        </div>
      </div>
      <!-- Tabs -->
      <div class="flex border-b profile-border px-4 gap-8 mt-4" id="profile-tabs">
        <button class="flex flex-col items-center justify-center profile-tab-inactive pb-3 pt-4 text-sm font-bold cursor-pointer profile-link tab-btn" data-tab="assignments">Problems</button>
        <button class="flex flex-col items-center justify-center profile-tab-inactive pb-3 pt-4 text-sm font-bold cursor-pointer profile-link tab-btn" data-tab="typing">Typing Practice History</button>
        <button class="flex flex-col items-center justify-center profile-tab-inactive pb-3 pt-4 text-sm font-bold cursor-pointer profile-link tab-btn" data-tab="notes">Saved Cheatsheets</button>
      </div>
      <!-- Tab Contents -->
      <div class="tab-content active" id="tab-assignments">
        <div class="flex justify-between items-center px-4 pt-6 pb-2">
          <h3 class="main-heading text-lg font-bold">Recent Problems</h3>
          <a href="#" class="profile-link text-sm font-bold">View All</a>
        </div>
        <div class="flex flex-col gap-3 px-4" id="assignments-list">
          <div class="text-gray-400 text-center py-8">Loading problems...</div>
        </div>
      </div>
      <div class="tab-content" id="tab-typing">
        <div class="flex justify-between items-center px-4 pt-6 pb-2">
          <h3 class="main-heading text-lg font-bold">Typing Practice History</h3>
          <a href="#" class="profile-link text-sm font-bold">View All</a>
        </div>
        <div class="flex flex-col gap-6 px-4 py-6">
          <div id="typing-history-chart"></div>
          <div id="typing-history-list"></div>
        </div>
      </div>
      <div class="tab-content" id="tab-notes">
        <div class="flex justify-between items-center px-4 pt-6 pb-2">
          <h3 class="main-heading text-lg font-bold">Saved Cheatsheets</h3>
          <a href="#" class="profile-link text-sm font-bold">View All</a>
        </div>
        <div class="flex flex-col gap-3 px-4 pb-12" id="saved-cheatsheets-list">
          <div class="text-gray-400 text-center py-8">Loading saved cheatsheets...</div>
        </div>
      </div>
    </div>
  </div>
  
  <style>
    body.light #site-footer {
      color: #222 !important;
      border-color: #e5e7eb !important;
    }
    body.light #site-footer .text-gray-400, body.light #site-footer .text-gray-300 {
      color: #111 !important;
    }
    body.light #site-footer .hover\:text-blue-400:hover {
      color: #2563eb !important;
    }
    body.light #site-footer .border-gray-800 {
      border-color: #e5e7eb !important;
    }
    body.light #firebase-login-btn {
      color: #fff !important;
    }
    @media (max-width: 640px) {
      #site-footer {
        padding: 2rem 1rem !important;
      }
      #site-footer .max-w-7xl {
        flex-direction: column !important;
        gap: 2.5rem !important;
        align-items: center !important;
      }
      #site-footer .flex-1.grid {
        grid-template-columns: 1fr !important;
        gap: 2rem !important;
        width: 100%;
      }
      #site-footer .flex-1 {
        min-width: 0 !important;
        align-items: center !important;
        text-align: center !important;
      }
      #site-footer .font-bold.mb-3.text-lg {
        font-size: 1.1rem !important;
        margin-bottom: 0.5rem !important;
      }
      #site-footer ul.space-y-2 {
        gap: 0.5rem !important;
      }
      #site-footer .flex.gap-6.mt-4, #site-footer .flex.gap-6 {
        justify-content: center !important;
        margin-top: 1.5rem !important;
        gap: 1.5rem !important;
      }
      #site-footer #footer-logo {
        margin: 0 auto 1rem auto !important;
        display: block !important;
      }
      #site-footer p.max-w-xs {
        max-width: 100% !important;
        font-size: 1rem !important;
        margin: 0 auto 1.5rem auto !important;
      }
    }
  </style>
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <!-- Firebase Auth -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <!-- Firebase Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <!-- Firebase Storage -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script>
    // Firebase config (same as index.html)
    const firebaseConfig = {
      apiKey: "AIzaSyCtsxaVgkd4utMd0OF6zriIuYwERGTlP6g",
      authDomain: "codepolarity-a8c63.firebaseapp.com",
      projectId: "codepolarity-a8c63",
      storageBucket: "codepolarity-a8c63.appspot.com",
      messagingSenderId: "712143434692",
      appId: "1:712143434692:web:a7039ebf3cc1a56d1e6a91",
      measurementId: "G-R81RELCW6N"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // UI Elements
    const avatarDiv = document.getElementById('profile-avatar');
    const editAvatarBtn = document.getElementById('edit-avatar-btn');
    const avatarInput = document.getElementById('avatar-file-input');
    const nameEl = document.querySelector('.main-heading');
    const usernameEl = document.querySelector('.profile-muted.text-base');
    const editProfileBtn = document.querySelector('button.bg-blue-500');
    const statNums = document.querySelectorAll('.stat-num');
    const statCards = document.querySelectorAll('.profile-card');
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = {
      assignments: document.getElementById('tab-assignments'),
      typing: document.getElementById('tab-typing'),
      notes: document.getElementById('tab-notes'),
    };
    // Loading indicator
    let loadingDiv = document.createElement('div');
    loadingDiv.innerHTML = '<div class="fixed inset-0 bg-black/40 flex items-center justify-center z-50"><div class="w-16 h-16 border-4 border-blue-400 border-t-transparent rounded-full animate-spin"></div></div>';
    loadingDiv.style.display = 'none';
    document.body.appendChild(loadingDiv);
    function setLoading(loading) {
      loadingDiv.style.display = loading ? '' : 'none';
    }

    // Auth state
    function renderProfile(user, userData) {
      if (!user) {
        const avatarContainer = document.getElementById('profile-avatar-container');
        const avatarImg = document.getElementById('profile-avatar-img');
        const avatarFallback = document.getElementById('profile-avatar-fallback');
        avatarContainer.style.backgroundImage = "url('https://ui-avatars.com/api/?name=User')";
        avatarImg.style.display = 'none';
        avatarFallback.style.display = 'flex';
        avatarFallback.textContent = 'U';
        avatarFallback.style.background = '#60a7fa';
        avatarContainer.style.backgroundSize = 'cover';
        editAvatarBtn.style.display = 'none';
      }
      // Remove login button if present
      let loginBtn = document.getElementById('login-btn');
      if (loginBtn) loginBtn.remove();
      // Avatar
      const avatarContainer = document.getElementById('profile-avatar-container');
      const avatarImg = document.getElementById('profile-avatar-img');
      const avatarFallback = document.getElementById('profile-avatar-fallback');
      let avatarUrl = user.photoURL;
      if (!avatarUrl) {
        avatarUrl = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.uid || 'User');
      }
      avatarImg.src = avatarUrl;
      avatarImg.style.display = 'block';
      avatarFallback.style.display = 'none';
      avatarImg.onerror = function() {
        avatarImg.style.display = 'none';
        avatarFallback.style.display = 'flex';
        avatarFallback.textContent = user.displayName ? user.displayName[0] : 'U';
        avatarFallback.style.background = '#60a7fa';
      };
      avatarImg.onload = function() {
        avatarImg.style.display = 'block';
        avatarFallback.style.display = 'none';
      };
      // If no photoURL and no user ID, show fallback immediately
      if (!avatarUrl) {
        avatarImg.style.display = 'none';
        avatarFallback.style.display = 'flex';
        avatarFallback.textContent = user.displayName ? user.displayName[0] : 'U';
        avatarFallback.style.background = '#60a7fa';
      }
      // Name
      nameEl.textContent = user.displayName || 'User';
      // Edit profile
      editProfileBtn.style.display = '';
      // Stats
      statNums[0].textContent = userData?.problems ?? 0;
      statNums[1].textContent = userData?.codeHours ?? 0;
      statNums[2].textContent = userData?.wpm ?? 0;
      statNums[3].textContent = userData?.ai ?? 0;
      // Render assignments
      renderAssignments(user.uid);
    }

    // Render assignments with user progress
    async function renderAssignments(uid) {
      setLoading(true);
      const list = document.getElementById('assignments-list');
      try {
        // Fetch all assignments
        const assignmentsSnap = await db.collection('assignments').get();
        const assignments = [];
        assignmentsSnap.forEach(doc => assignments.push({ id: doc.id, ...doc.data() }));
        // Fetch user progress
        const progressSnap = await db.collection('users').doc(uid).collection('assignmentProgress').get();
        const progressMap = {};
        progressSnap.forEach(doc => progressMap[doc.id] = doc.data());
        // Render
        if (assignments.length === 0) {
          list.innerHTML = '<div class="text-gray-400 text-center py-8">No problems available.</div>';
          return;
        }
        list.innerHTML = '';
        assignments.forEach(assignment => {
          const userProgress = progressMap[assignment.id] || { status: 'Not Started' };
          const statusColor = userProgress.status === 'Completed' ? 'bg-green-400' : userProgress.status === 'In Progress' ? 'bg-yellow-400' : 'bg-gray-500';
          const statusText = userProgress.status || 'Not Started';
          const solveLink = assignment.speedcodeLink || '#';
          const card = document.createElement('div');
          card.className = 'flex items-center gap-4 profile-card px-4 min-h-[72px] py-2 justify-between hover:scale-[1.01] transition-transform mb-2';
          card.innerHTML = `
            <div class="flex items-center gap-4">
              <div class="flex items-center justify-center rounded-lg bg-gray-900 shrink-0 w-12 h-12">
                <svg class="w-6 h-6 stat-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2a4 4 0 014-4h2a4 4 0 014 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          </div>
              <div class="flex flex-col justify-center">
                <p class="text-base font-medium">${assignment.title}</p>
                <span class="inline-block ${statusColor} text-xs text-black font-bold px-2 py-0.5 rounded mb-1 status-badge">${statusText}</span>
                <p class="profile-muted text-sm">${assignment.description || ''}</p>
              </div>
            </div>
            <div class="shrink-0 flex flex-col items-end gap-2">
              <a href="${solveLink}" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold px-4 py-1 rounded shadow transition mb-1">Solve in SpeedCode</a>
              ${userProgress.status !== 'Completed' ? `<button class="bg-green-500 hover:bg-green-600 text-white text-xs font-bold px-4 py-1 rounded shadow transition mark-completed-btn" data-id="${assignment.id}">Mark as Completed</button>` : ''}
          </div>
        `;
          list.appendChild(card);
        });
        // Add event listeners for 'Mark as Completed' buttons
        list.querySelectorAll('.mark-completed-btn').forEach(btn => {
          btn.addEventListener('click', async function() {
            const assignmentId = btn.getAttribute('data-id');
            btn.disabled = true;
            btn.textContent = 'Marking...';
            try {
              await db.collection('users').doc(uid).collection('assignmentProgress').doc(assignmentId).set({ status: 'Completed', lastSolvedAt: firebase.firestore.FieldValue.serverTimestamp() }, { merge: true });
              // Update UI immediately
              const badge = btn.closest('.profile-card').querySelector('.status-badge');
              badge.textContent = 'Completed';
              badge.className = 'inline-block bg-green-400 text-xs text-black font-bold px-2 py-0.5 rounded mb-1 status-badge';
              btn.remove();
            } catch (e) {
              btn.textContent = 'Error';
              btn.disabled = false;
              alert('Failed to mark as completed.');
            }
          });
        });
      } catch (e) {
        list.innerHTML = '<div class="text-red-400 text-center py-8">Failed to load problems.</div>';
      } finally {
        setLoading(false);
      }
    }
    // Render typing practice history
    async function renderTypingHistory(uid) {
      setLoading(true);
      const list = document.getElementById('typing-history-list');
      const chartContainer = document.getElementById('typing-history-chart');
      try {
        // Fetch typing sessions (most recent first)
        const snap = await db.collection('users').doc(uid).collection('typingHistory').orderBy('date', 'desc').limit(30).get();
        const sessions = [];
        snap.forEach(doc => sessions.push({ id: doc.id, ...doc.data() }));
        // List
        if (sessions.length === 0) {
          list.innerHTML = '<div class="text-gray-400 text-center py-8">No typing practice history yet.</div>';
          chartContainer.innerHTML = '';
          return;
        }
        list.innerHTML = '';
        sessions.forEach(session => {
          const date = session.date && session.date.toDate ? session.date.toDate() : null;
          const dateStr = date ? date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '';
          const item = document.createElement('div');
          item.className = 'flex items-center justify-between profile-card px-4 py-2 mb-2';
          item.innerHTML = `
            <div class="flex flex-col">
              <span class="font-bold text-lg">${session.wpm ?? '-'} WPM</span>
              <span class="text-xs profile-muted">Accuracy: ${session.accuracy ?? '-'}%</span>
          </div>
            <div class="text-xs profile-muted">${dateStr}</div>
          `;
          list.appendChild(item);
        });
        // Chart
        chartContainer.innerHTML = '<canvas id="wpmHistoryChart" height="120"></canvas>';
        const ctx = document.getElementById('wpmHistoryChart').getContext('2d');
        const labels = sessions.map(s => s.date && s.date.toDate ? s.date.toDate().toLocaleDateString() : '').reverse();
        const data = sessions.map(s => s.wpm ?? 0).reverse();
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'WPM',
              data: data,
              borderColor: '#60a7fa',
              backgroundColor: 'rgba(96,167,250,0.1)',
              fill: true,
              tension: 0.3,
              pointRadius: 3,
              pointBackgroundColor: '#60a7fa',
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
              x: { ticks: { color: '#9ca3af', font: { size: 10 } }, grid: { color: '#222' } },
              y: { ticks: { color: '#9ca3af', font: { size: 10 } }, grid: { color: '#222' }, beginAtZero: true }
            }
          }
        });
      } catch (e) {
        list.innerHTML = '<div class="text-red-400 text-center py-8">Failed to load typing history.</div>';
        chartContainer.innerHTML = '';
      } finally {
        setLoading(false);
      }
    }
    // Render saved cheatsheets
    async function renderSavedCheatsheets(uid) {
      setLoading(true);
      const list = document.getElementById('saved-cheatsheets-list');
      try {
        const snap = await db.collection('users').doc(uid).collection('savedCheatsheets').orderBy('dateSaved', 'desc').get();
        const cheatsheets = [];
        snap.forEach(doc => cheatsheets.push({ id: doc.id, ...doc.data() }));
        if (cheatsheets.length === 0) {
          list.innerHTML = '<div class="text-gray-400 text-center py-8">No saved cheatsheets yet.</div>';
          return;
        }
        list.innerHTML = '';
        cheatsheets.forEach(sheet => {
          const date = sheet.dateSaved && sheet.dateSaved.toDate ? sheet.dateSaved.toDate() : null;
          const dateStr = date ? date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '';
          const item = document.createElement('div');
          item.className = 'flex items-center justify-between profile-card px-4 py-2 mb-2';
          item.innerHTML = `
            <div class="flex flex-col">
              <span class="font-bold text-base">${sheet.title || 'Untitled Cheatsheet'}</span>
              <span class="text-xs profile-muted">${sheet.description || ''}</span>
              <a href="${sheet.link || '#'}" target="_blank" class="text-blue-400 hover:underline text-xs mt-1">View Cheatsheet</a>
              </div>
            <div class="flex flex-col items-end gap-2">
              <span class="text-xs profile-muted">${dateStr}</span>
              <button class="bg-red-500 hover:bg-red-600 text-white text-xs font-bold px-3 py-1 rounded shadow transition remove-cheatsheet-btn" data-id="${sheet.id}">Remove</button>
            </div>
          `;
          list.appendChild(item);
        });
        // Remove button logic
        list.querySelectorAll('.remove-cheatsheet-btn').forEach(btn => {
          btn.addEventListener('click', async function() {
            const id = btn.getAttribute('data-id');
            btn.disabled = true;
            btn.textContent = 'Removing...';
            try {
              await db.collection('users').doc(uid).collection('savedCheatsheets').doc(id).delete();
              btn.closest('.profile-card').remove();
              if (!list.querySelector('.profile-card')) {
                list.innerHTML = '<div class="text-gray-400 text-center py-8">No saved cheatsheets yet.</div>';
              }
            } catch (e) {
              btn.textContent = 'Error';
              btn.disabled = false;
              alert('Failed to remove cheatsheet.');
            }
          });
        });
      } catch (e) {
        list.innerHTML = '<div class="text-red-400 text-center py-8">Failed to load saved cheatsheets.</div>';
      } finally {
        setLoading(false);
      }
    }
    // Fetch user data from Firestore
    async function fetchUserData(uid) {
      setLoading(true);
      try {
        const doc = await db.collection('users').doc(uid).get();
        return doc.exists ? doc.data() : {};
      } catch (e) {
        return {};
      } finally {
        setLoading(false);
      }
    }
    // Save username
    async function saveUsername(uid, username) {
      setLoading(true);
      try {
        await db.collection('users').doc(uid).set({ username }, { merge: true });
      } finally {
        setLoading(false);
      }
    }
    // Edit profile logic
    editProfileBtn.onclick = async function() {
      const user = auth.currentUser;
      if (!user) return;
      const newName = prompt('Enter new display name:', user.displayName || '');
      if (newName && newName !== user.displayName) {
        setLoading(true);
        await user.updateProfile({ displayName: newName });
        setLoading(false);
        renderProfile(user, await fetchUserData(user.uid));
      }
      const newUsername = prompt('Enter new username:', (await fetchUserData(user.uid)).username || '');
      if (newUsername) {
        await saveUsername(user.uid, newUsername);
        renderProfile(user, await fetchUserData(user.uid));
      }
    };
    // Avatar upload
    editAvatarBtn.onclick = function() {
      avatarInput.accept = 'image/*';
      avatarInput.click();
    };
    avatarInput.onchange = async function(e) {
      const file = e.target.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) {
        alert('Please select an image file.');
        return;
      }
      setLoading(true);
      const statusMsg = document.createElement('div');
      statusMsg.textContent = 'Uploading avatar...';
      statusMsg.style.position = 'fixed';
      statusMsg.style.top = '80px';
      statusMsg.style.right = '24px';
      statusMsg.style.background = '#23272f';
      statusMsg.style.color = '#fff';
      statusMsg.style.padding = '10px 20px';
      statusMsg.style.borderRadius = '8px';
      statusMsg.style.zIndex = 9999;
      document.body.appendChild(statusMsg);
      try {
        const user = auth.currentUser;
        if (!user) throw new Error('Not logged in');
        const storageRef = storage.ref();
        const avatarRef = storageRef.child(`avatars/${user.uid}`);
        await avatarRef.put(file);
        const url = await avatarRef.getDownloadURL();
        await user.updateProfile({ photoURL: url });
        await db.collection('users').doc(user.uid).set({ photoURL: url }, { merge: true });
        // Update avatar everywhere
        renderProfile(user, await fetchUserData(user.uid));
        updateNavbarAuthUI(user);
        statusMsg.textContent = 'Avatar updated!';
        statusMsg.style.background = '#10b981';
        setTimeout(() => statusMsg.remove(), 1800);
      } catch (err) {
        statusMsg.textContent = 'Failed to update avatar.';
        statusMsg.style.background = '#e53935';
        setTimeout(() => statusMsg.remove(), 2500);
      }
      setLoading(false);
    };
    // Auth state
    auth.onAuthStateChanged(async function(user) {
      if (user) {
        const userData = await fetchUserData(user.uid);
        renderProfile(user, userData);
        // Auto-mark assignment as completed if URL has ?completed=assignmentId
        const params = new URLSearchParams(window.location.search);
        const completedId = params.get('completed');
        if (completedId) {
          try {
            await db.collection('users').doc(user.uid).collection('assignmentProgress').doc(completedId).set({ status: 'Completed', lastSolvedAt: firebase.firestore.FieldValue.serverTimestamp() }, { merge: true });
            alert('Assignment marked as completed!');
            // Optionally, remove the param from the URL
            params.delete('completed');
            window.history.replaceState({}, document.title, window.location.pathname);
            // Refresh assignments UI
            renderAssignments(user.uid);
          } catch (e) {
            alert('Failed to auto-mark assignment as completed.');
          }
        }
        // Render typing history
        renderTypingHistory(user.uid);
        // Render saved cheatsheets
        renderSavedCheatsheets(user.uid);
      } else {
        renderProfile(null, null);
        document.getElementById('typing-history-list').innerHTML = '<div class="text-gray-400 text-center py-8">Login to view your typing practice history.</div>';
        document.getElementById('typing-history-chart').innerHTML = '';
        document.getElementById('saved-cheatsheets-list').innerHTML = '<div class="text-gray-400 text-center py-8">Login to view your saved cheatsheets.</div>';
      }
    });
    // Logout
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
      logoutBtn.onclick = function() {
        auth.signOut();
      };
    }
    // Tabs logic (already present)
    // Make first tab active by default
    tabBtns[0].classList.add('profile-tab-active');
    tabBtns[0].classList.remove('profile-tab-inactive');
    tabContents[tabBtns[0].getAttribute('data-tab')].classList.add('active');
    tabBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        tabBtns.forEach(b => b.classList.remove('profile-tab-active'));
        tabBtns.forEach(b => b.classList.add('profile-tab-inactive'));
        btn.classList.add('profile-tab-active');
        btn.classList.remove('profile-tab-inactive');
        Object.keys(tabContents).forEach(key => tabContents[key].classList.remove('active'));
        tabContents[btn.getAttribute('data-tab')].classList.add('active');
      });
    });
    // Navbar Auth UI logic
    function updateNavbarAuthUI(user) {
      const loginBtn = document.getElementById('desktop-login-btn');
      const profileLi = document.getElementById('desktop-profile');
      const avatarSpan = document.getElementById('navbar-avatar');
      if (loginBtn && profileLi) {
        if (user) {
          loginBtn.style.display = 'none';
          profileLi.classList.remove('hidden');
          // Set avatar image or initial
          if (avatarSpan) {
            if (user.photoURL) {
              avatarSpan.style.backgroundImage = `url('${user.photoURL}')`;
              avatarSpan.style.backgroundColor = 'transparent';
              avatarSpan.textContent = '';
            } else {
              let initial = 'U';
              if (user.displayName && user.displayName.length > 0) {
                initial = user.displayName[0];
              }
              avatarSpan.style.backgroundImage = '';
              avatarSpan.style.backgroundColor = '#60a7fa';
              avatarSpan.textContent = initial;
            }
          }
        } else {
          loginBtn.style.display = '';
          profileLi.classList.add('hidden');
        }
      }
    }
    // Firebase Auth state for navbar
    firebase.auth().onAuthStateChanged(function(user) {
      updateNavbarAuthUI(user);
    });
    // Login button
    document.getElementById('navbar-login-btn').onclick = function() {
      firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider());
    };
    // Logout button
    document.getElementById('logout-btn').onclick = function() {
      firebase.auth().signOut();
      // Hide dropdown
      document.getElementById('profile-menu').classList.add('opacity-0', 'invisible');
      document.getElementById('profile-menu').classList.remove('opacity-100', 'visible');
    };
    // Dropdown for Resources (works on hover and click)
    document.addEventListener('DOMContentLoaded', function() {
      const btn = document.getElementById('resources-btn');
      const menu = document.getElementById('resources-menu');
      const practiceBtn = document.getElementById('practice-btn');
      const practiceMenu = document.getElementById('practice-menu');
      let open = false;

      // Show/hide on click (for mobile/touch)
      btn.addEventListener('click', function(e) {
        e.stopPropagation();
        open = !open;
        menu.classList.toggle('opacity-100', open);
        menu.classList.toggle('visible', open);
        menu.classList.toggle('opacity-0', !open);
        menu.classList.toggle('invisible', !open);
        btn.setAttribute('aria-expanded', open);
        // Close Practice dropdown if open
        if (practiceMenu && practiceMenu.classList.contains('opacity-100')) {
          practiceMenu.classList.remove('opacity-100', 'visible');
          practiceMenu.classList.add('opacity-0', 'invisible');
          if (practiceBtn) practiceBtn.setAttribute('aria-expanded', 'false');
        }
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        if (open && !menu.contains(e.target) && !btn.contains(e.target)) {
          open = false;
          menu.classList.remove('opacity-100', 'visible');
          menu.classList.add('opacity-0', 'invisible');
          btn.setAttribute('aria-expanded', 'false');
        }
      });

      // Close dropdown when selecting an item
      menu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', function() {
          open = false;
          menu.classList.remove('opacity-100', 'visible');
          menu.classList.add('opacity-0', 'invisible');
          btn.setAttribute('aria-expanded', 'false');
        });
      });
    });
    // Dropdown for Practice (works on hover and click)
    document.addEventListener('DOMContentLoaded', function() {
      const btn = document.getElementById('practice-btn');
      const menu = document.getElementById('practice-menu');
      const resourcesBtn = document.getElementById('resources-btn');
      const resourcesMenu = document.getElementById('resources-menu');
      let open = false;
      if (btn && menu) {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          open = !open;
          menu.classList.toggle('opacity-100', open);
          menu.classList.toggle('visible', open);
          menu.classList.toggle('opacity-0', !open);
          menu.classList.toggle('invisible', !open);
          btn.setAttribute('aria-expanded', open);
          // Close Resources dropdown if open
          if (resourcesMenu && resourcesMenu.classList.contains('opacity-100')) {
            resourcesMenu.classList.remove('opacity-100', 'visible');
            resourcesMenu.classList.add('opacity-0', 'invisible');
            if (resourcesBtn) resourcesBtn.setAttribute('aria-expanded', 'false');
          }
        });
        document.addEventListener('click', function(e) {
          if (open && !menu.contains(e.target) && !btn.contains(e.target)) {
            open = false;
            menu.classList.remove('opacity-100', 'visible');
            menu.classList.add('opacity-0', 'invisible');
            btn.setAttribute('aria-expanded', 'false');
          }
        });
        menu.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', function() {
            open = false;
            menu.classList.remove('opacity-100', 'visible');
            menu.classList.add('opacity-0', 'invisible');
            btn.setAttribute('aria-expanded', 'false');
          });
        });
      }
    });
    // Mobile theme toggle logic
    const themeToggleMobile = document.getElementById('theme-toggle-mobile');
    const themeToggleMobileIcon = document.getElementById('theme-toggle-mobile-icon');
    function setThemeMobile(mode) {
      if (mode === 'light') {
        document.body.classList.add('light');
        themeToggleMobileIcon.innerHTML = '<circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2m11-11h-2M3 12H1m16.95 7.07l-1.41-1.41M6.34 6.34L4.93 4.93m12.02 0l-1.41 1.41M6.34 17.66l-1.41 1.41"/>';
      } else {
        document.body.classList.remove('light');
        themeToggleMobileIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 1 0 9.79 9.79z"/>';
      }
      localStorage.setItem('theme', mode);
    }
    themeToggleMobile.onclick = function() {
      const isLight = document.body.classList.toggle('light');
      setThemeMobile(isLight ? 'light' : 'dark');
    };
    // On load, set theme from localStorage for mobile toggle
    (function() {
      const saved = localStorage.getItem('theme');
      if (saved === 'light') setThemeMobile('light');
      else setThemeMobile('dark');
    })();
    // Desktop theme toggle logic (animated, matches home page)
    const themeToggle = document.getElementById('theme-toggle');
    const themeToggleKnob = document.getElementById('theme-toggle-knob');
    const themeToggleSun = document.getElementById('theme-toggle-sun');
    const themeToggleMoon = document.getElementById('theme-toggle-moon');
    function setTheme(mode) {
      if (mode === 'light') {
        document.body.classList.add('light');
        if (themeToggle) themeToggle.classList.add('light');
        if (themeToggleKnob) {
          themeToggleKnob.style.transform = 'translateX(20px)';
          themeToggleKnob.classList.add('bg-yellow-400', 'text-blue-700');
          themeToggleKnob.classList.remove('bg-blue-500', 'text-white');
        }
        if (themeToggleSun) themeToggleSun.style.opacity = 1;
        if (themeToggleMoon) themeToggleMoon.style.opacity = 0;
      } else {
        document.body.classList.remove('light');
        if (themeToggle) themeToggle.classList.remove('light');
        if (themeToggleKnob) {
          themeToggleKnob.style.transform = 'translateX(0)';
          themeToggleKnob.classList.remove('bg-yellow-400', 'text-blue-700');
          themeToggleKnob.classList.add('bg-blue-500', 'text-white');
        }
        if (themeToggleSun) themeToggleSun.style.opacity = 0;
        if (themeToggleMoon) themeToggleMoon.style.opacity = 1;
      }
      localStorage.setItem('theme', mode);
    }
    if (themeToggle) {
      themeToggle.onclick = function() {
        const isLight = document.body.classList.toggle('light');
        setTheme(isLight ? 'light' : 'dark');
      };
    }
    // On load, set theme from localStorage for both desktop and mobile
    (function() {
      const saved = localStorage.getItem('theme');
      if (saved === 'light') {
        setTheme('light');
        setThemeMobile('light');
      } else {
        setTheme('dark');
        setThemeMobile('dark');
      }
    })();
    // Mobile menu open/close logic with sliding animation
    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');
      const mobileResourcesBtn = document.getElementById('mobile-resources-btn');
      const mobileResourcesMenu = document.getElementById('mobile-resources-menu');
      const mobilePracticeBtn = document.getElementById('mobile-practice-btn');
      const mobilePracticeMenu = document.getElementById('mobile-practice-menu');
      let mobileMenuOpen = false;
      function openMenu() {
        mobileMenu.classList.remove('translate-x-full', 'pointer-events-none');
        mobileMenu.classList.add('translate-x-0');
        document.body.style.overflow = 'hidden';
        mobileMenuOpen = true;
      }
      function closeMenu() {
        mobileMenu.classList.add('translate-x-full', 'pointer-events-none');
        mobileMenu.classList.remove('translate-x-0');
        document.body.style.overflow = '';
        mobileMenuOpen = false;
        // Close dropdowns
        closeMobileDropdown(mobileResourcesMenu);
        closeMobileDropdown(mobilePracticeMenu);
      }
      mobileMenuBtn.addEventListener('click', function() {
        if (mobileMenuOpen) {
          closeMenu();
        } else {
          openMenu();
        }
      });
      document.addEventListener('keydown', function(e) {
        if (mobileMenuOpen && e.key === 'Escape') {
          closeMenu();
        }
      });
      // Dropdowns in mobile menu with slide
      function toggleMobileDropdown(menu) {
        if (menu.style.maxHeight && menu.style.maxHeight !== '0px') {
          closeMobileDropdown(menu);
        } else {
          menu.classList.remove('max-h-0');
          menu.classList.add('max-h-32');
          menu.style.maxHeight = menu.scrollHeight + 'px';
        }
      }
      function closeMobileDropdown(menu) {
        menu.classList.add('max-h-0');
        menu.classList.remove('max-h-32');
        menu.style.maxHeight = '0px';
      }
      mobileResourcesBtn.addEventListener('click', function() {
        toggleMobileDropdown(mobileResourcesMenu);
      });
      mobilePracticeBtn.addEventListener('click', function() {
        toggleMobileDropdown(mobilePracticeMenu);
      });
      // Close menu when clicking outside (optional, for overlay)
      mobileMenu.addEventListener('click', function(e) {
        if (e.target === mobileMenu) closeMenu();
      });
    });
    // Mobile Auth UI logic
    function updateMobileAuthUI(user) {
      const loginBtn = document.getElementById('firebase-login-btn-mobile');
      const profileDiv = document.getElementById('mobile-profile');
      if (loginBtn && profileDiv) {
        if (user) {
          loginBtn.style.display = 'none';
          profileDiv.style.display = 'flex';
          // Set avatar and name
          const avatar = profileDiv.querySelector('span.inline-block');
          const name = profileDiv.querySelector('span.font-semibold');
          let avatarUrl = user.photoURL;
          if (!avatarUrl) {
            avatarUrl = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.uid || 'User');
          }
          if (avatar) {
            avatar.style.backgroundImage = `url('${avatarUrl}')`;
            avatar.style.backgroundSize = 'cover';
            avatar.textContent = user.displayName ? user.displayName[0] : 'U';
          }
          if (name) name.textContent = user.displayName || 'User';
        } else {
          loginBtn.style.display = '';
          profileDiv.style.display = 'none';
        }
      }
    }
    firebase.auth().onAuthStateChanged(function(user) {
      updateMobileAuthUI(user);
    });
    document.getElementById('firebase-login-btn-mobile').onclick = function() {
      firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider());
    };
    document.getElementById('mobile-logout-btn').onclick = function() {
      firebase.auth().signOut();
      // Also close mobile menu
      document.getElementById('mobile-menu').classList.add('translate-x-full', 'pointer-events-none');
      document.getElementById('mobile-menu').classList.remove('translate-x-0');
      document.body.style.overflow = '';
    };
  </script>
</body>
</html> 